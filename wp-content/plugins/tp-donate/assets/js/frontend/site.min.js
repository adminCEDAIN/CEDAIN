!function(e){DONATE_Site={$doc:null,init:function(){this.$doc=e(document),this.validate_checkout_form(),this.generate_percent(),this.$doc.on("click",".donate_payments li a",this.payment_gateway_tab),this.$doc.on("click",".donate_load_form, .donate_button_title",this.load_donate_form),this.$doc.on("submit",".donate_form",this.donate_submit),this.hooks.init()},hooks:{init:function(){TP_Donate_Global.addAction("donate_submit_submited_form_completed",this.submited)},submited:function(t){"success"===t.status&&"undefined"!=typeof t.url?window.location.href=t.url:"failed"===t.status&&"undefined"!=typeof t.message&&(DONATE_Site.generate_messages(t.message),e("body, html").animate({scrollTop:e(".donation-messages").offset().top}))}},payment_gateway_tab:function(t){t.preventDefault();var n=e(this),a=n.parents("li:first"),o=n.attr("data-payment-id"),i=e('input[name="payment_method"]'),d=n.attr("href"),s=e(".payment-method");return!a.hasClass("active")&&(i.val(o),n.parents(".donate_payments:first").find("li").removeClass("active"),a.addClass("active"),s.slideUp(400,function(){e(d).slideDown()}),!1)},load_donate_form:function(t){t.preventDefault();var n=e(this),a=n.attr("data-campaign-id"),o={action:"donate_load_form",nonce:thimpress_donate.nonce};"undefined"!=typeof a&&(o.campaign_id=a),e.ajax({url:thimpress_donate.ajaxurl,type:"POST",data:o,dataType:"html",beforeSend:function(){TP_Donate_Global.beforeAjax()}}).done(function(t){TP_Donate_Global.afterAjax(),e("#donate_hidden").html(t),e.magnificPopup.open({type:"inline",items:{src:"#donate_hidden"},callbacks:{open:function(){var t=setTimeout(function(){e('#donate_hidden input[name="donate_input_amount"]:first').focus(),e('#donate_hidden input[name="payment_method"]:first').attr("checked",!0),TP_Donate_Global.applyFilters("donate_loaded_donate_form",o),clearTimeout(t)},100)}}})})},validate_checkout_form:function(){for(var t=e(".donate_form"),n=t.find("input, textarea"),a=0;a<n.length;a++){var o=e(n[a]);o.blur(function(){var t=e(this);t.hasClass("required")&&(""===t.val()||t.hasClass("email")&&new RegExp("^[-!#$%&'*+\\./0-9=?A-Z^_`a-z{|}~]+@[-!#$%&'*+\\/0-9=?A-Z^_`a-z{|}~]+.[-!#$%&'*+\\./0-9=?A-Z^_`a-z{|}~]+$").test(t.val())===!1?t.removeClass("validated").addClass("donate_input_invalid").addClass("error"):t.removeClass("donate_input_invalid").removeClass("error").addClass("validated"))})}},donate_submit:function(t){t.preventDefault();var n=e(this);n.find(".donate_form_layout"),n.find(".donation-messages");n.find(".donate_form_error_messages").remove();var a=n.serializeArray(n);if(TP_Donate_Global.applyFilters("donate_before_submit_form",a))return e.ajax({url:thimpress_donate.ajaxurl,type:"POST",data:a,beforeSend:function(){TP_Donate_Global.beforeAjax()}}).done(function(t){if(TP_Donate_Global.afterAjax(),t=TP_Donate_Global.applyFilters("donate_submit_submited_form_results",t),"undefined"!=typeof t.status&&(t&&TP_Donate_Global.doAction("donate_submit_submited_form_completed",t),"undefined"!=typeof t.form&&"undefined"!=typeof t.args&&t.form===!0)){var a=t.args;if(0!==Object.keys(a).length){var o=[];o.push('<form id="donate_form_instead" action="'+t.url+'" method="POST">'),e.each(a,function(e,t){o.push('<input type="hidden" name="'+e+'" value="'+t+'" />')}),o.push('<button type="submit" class="donate-redirecting">'+t.submit_text+"</button>"),o.push("</form>"),n.replaceWith(o.join("")),e("#donate_form_instead").submit()}}}),!1},donate_on_lightbox:function(){return"undefined"!=typeof thimpress_donate.settings&&"undefined"!=typeof thimpress_donate.settings.checkout&&"undefined"!=typeof thimpress_donate.settings.checkout.lightbox_checkout&&"yes"===thimpress_donate.settings.checkout.lightbox_checkout},generate_messages:function(t){var n=e(".donate_form_layout");1===n.find(".donation-messages").length?e(".donation-messages").replaceWith(t):n.prepend(t)},beforeAjax:function(e){"undefined"!=typeof e&&e.find(".donate_button").addClass("donate_button_processing")},afterAjax:function(e){"undefined"!=typeof e&&e.find(".donate_button").removeClass("donate_button_processing")},generate_percent:function(){for(var t=e(".donate_counter_percent"),n=0;n<t.length;n++){var a=e(t[n]),o=a.attr("data-percent"),i=a.parent(".donate_counter:first"),d=i.outerWidth(),s=a.find(".donate_percent_tooltip"),r=s.outerWidth();a.css({width:o+"%"}),r/2>=a.outerWidth()?s.css({left:0}):r/2+a.outerWidth()<=d?s.css({left:a.outerWidth()-r/2}):r/2+a.outerWidth()>d&&s.css({left:d-r})}}},e(document).ready(function(){DONATE_Site.init()}),e(window).resize(function(){DONATE_Site.generate_percent()})}(jQuery);